<!DOCTYPE html>
<html>
	<head>
    <title>Country GDP vs Ease of business</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
	</head>

	<body>
        <form action="#">
            <button type="button" onclick="console.log(emails_dict)"> emails_dict </button>
            <button type="button" onclick="console.log(emails_list)"> emails_list </button>
            <button type="button" onclick="console.log(users_list)"> users_list </button>
        </form>
        <p id="out"></p>
        <script type="text/javascript">
            var users_dict;
            var users_list;
            var emails_dict;
            var emails_list;
                        
            d3.json("users.json", function(data) {
                users_dict = data;
                users_list = users_load(data);
            });
            
            d3.json("small_emails.json", function(data) {
                emails_dict = data;
                emails_list = emails_load(data);
                var max = d3.max(emails_list, function(d) {
                    return d.date;
                });
                var min = d3.min(emails_list, function(d) {
                    return d.date;
                });
                console.log(max);
                console.log(min);
            });
            
            function users_load(data) {
                var data_list = [];
                var tmp;
                var key;
                for (key in data) {
                    tmp = {
                        name: key,
                        emails_sent: data[key]['emails_sent'],
                        users_communicated_with: data[key]['users_communicated_with']
                    }
                    data_list.push(tmp);
                }
                return data_list;
            }
            
            function emails_load(data) {
                var data_list = [];
                var tmp;
                var key;
                for (key in data)  {
                    data[key]['date'] = new Date(data[key]['date']);
                    data_list.push(data[key]); //any issues with push the direct object to the array? (since they point to the same obj?)
                }
                return data_list;
            }
            
//            function filter_for_selected_user(data, user) {
//                
//                
//            }
//            //Load data into global var countries
//            var countries;
//            
//            d3.csv("data.csv", function(data) {
//                countries = load(data);
//                List.init();
//                Scatterplot.init();
//                Dispatcher.add(List);
//                Dispatcher.add(Scatterplot);
//                Controller.load(countries);
//            });
//            
//            function load(data) {
//                var mappedData = data.map(function(d) {
//                    //Map the data
//                    return {
//                        name: d.Country,
//                        GDP: +d['GDP per Capita'].replace("$","").replace(",",""),
//                        GDPstring: d['GDP per Capita'],
//                        Year: new Date(d.Year).getYear() + 1900,
//                        EOB: +d['Ease of Business']
//                    }
//                });
//                
//                //Filter the data for the year 2012 only
//                mappedData = mappedData.filter(function(d) {
//                    return d.Year == 2012;
//                })
//                
//                //Sort in ascending order
//                mappedData = mappedData.sort(function(a,b) {
//                    return d3.ascending(a.name, b.name);
//                });
//                return mappedData;
//            }
            
//            var Dispatcher = {
//                //Add a view to the dispatcher's list of subscribers
//                add: function(view) {
//                    if(!this.subscribers) { 
//                        this.subscribers = [];
//                    }
//                    this.subscribers.push(view);
//                },
//                
//                //Notify each subscriber
//                notify: function(type, payload) {
//                    this.subscribers.forEach(function(s) {
//                        s[type](payload);
//                    });
//                }
//            }
//            
//            var Controller = {
//                load: function (data) {
//                    this.data = data;
//                    Dispatcher.notify('update', this.data);
//                }, 
//                
//                filter: function(value) {
//                    var filtered_data = this.data.filter(function(d) {
//                        return d.name.toLowerCase().indexOf(value.toLowerCase()) > -1;
//                    });
//                    Dispatcher.notify('update', filtered_data);
//                },
//                
//                remove: function(d) {
//                    this.data.splice(this.getIndex(d), 1);
//                    Dispatcher.notify('update', this.data);
//                },
//                
//                getIndex: function(d) {
//                    for(var i = 0; i < this.data.length; i++){
//                        if(this.data[i].name == d.name) {
//                            return i;
//                        }
//                    }
//                    return -1;
//                }
//            }
//            
//            var List = {
//                init: function() {
//                    this.list = d3.select("#list");
//                },
//                
//                update: function(data) {
//                    var selection = this.list.selectAll("li").data(data, function(d) {
//                        return d.name; 
//                    }); 
//                    selection.enter().append("li")
//                        .text(function(d) { 
//                            return d.name; 
//                        })
//                        .on('mouseover', function(d) {
//                            Dispatcher.notify('onMouseover', d);
//                        })
//                        .on('mouseout', function(d) {
//                            Dispatcher.notify('onMouseout', d);
//                        })
//                        .on('click', function(d) {
//                            Dispatcher.notify('onClick', d);
//                        }).on('contextmenu', function(d) { 
//                            Dispatcher.notify('onRight', d);
//                        });
//                    selection.exit().remove();
//                },
//                
//                onMouseover: function(d) {
//                    this.list.selectAll("li")
//                        .classed('highlighted', function(e) { return d.name == e.name });
//                },
//                
//                onMouseout: function(d) {
//                    this.list.selectAll("li")
//                        .classed('highlighted', false);
//                },
//                
//                onClick: function(d) {
//                },
//                
//                onRight: function(d) {
//                }
//            }
//            
//            var Scatterplot = {
//                init: function() {
//                    //Set dimensions of the viz
//                    d3.select("#viz").attr("width", 700);
//                    d3.select("#viz").attr("height", 500);
//                    
//                    //Establish X scale
//                    this.x_scale = d3.scale.linear();
//                    this.x_scale.range([40, 690]);
//                    
//                    //Establish Y scale
//                    this.y_scale = d3.scale.linear();
//                    this.y_scale.range([10, 480]);
//                    
//                    //Establish X axis
//                    this.x_axis = d3.svg.axis(); 
//                    this.x_axis.scale(this.x_scale);
//                    this.x_axis.orient("bottom");
//
//                    //Format the tick elements
//                    this.x_axis.tickFormat(function(d) { 
//                        var s = "";
//                        if (d > 1000) {
//                            s = d/1000 + "k";
//                        } else {
//                            s = s + d;
//                        }
//                        return "$" + s;
//                    });
//
//                    //Establish Y axis
//                    this.y_axis = d3.svg.axis();
//                    this.y_axis.scale(this.y_scale);
//                    this.y_axis.orient("left");
//                    
//                    //Append the axis
//                    this.x_axis_group = d3.select("#viz")
//                        .append("g")
//                        .attr("transform", "translate(0,480)");
//                    this.y_axis_group = d3.select("#viz")
//                        .append("g")
//                        .attr("transform", "translate(40,0)");
//                },
//                
//                update: function(data) {
//                    var self = this;
//                    
//                    //Update the scale
//                    this.x_scale.domain([0, d3.max(data, function(c) { return c.GDP; })]);
//                    this.y_scale.domain([d3.max(data, function(c) { return c.EOB; }), 0]); //svg grows from the top-left
//                    
//                    //Select viz tag
//                    var selection = d3.select("#viz").selectAll("circle").data(data, function(c) { 
//                        return c.name; 
//                    }); 
//                    selection.enter().append("circle")
//                        .on('mouseover', function(d) {
//                            Dispatcher.notify('onMouseover', d);                            
//                        }).on('mouseout', function(d) { //mouseout is when the mouse stops hovering over the element
//                            Dispatcher.notify('onMouseout', d);
//                        }).on('click', function(d) {
//                            Dispatcher.notify('onClick', d);
//                        }).on('contextmenu', function(d) { 
//                            Dispatcher.notify('onRight', d);
//                        });
//                    
//                    selection.exit().remove();
//                    
//                    selection.transition().attr({
//                        r: 5,
//                        cx: function(d) { return self.x_scale(d.GDP) },
//                        cy: function(d) { return this.y_scale(d.EOB) }.bind(this)
//                    });
//                    
//                    //Update axes
//                    this.x_axis_group.transition().call(this.x_axis);
//                    this.y_axis_group.transition().call(this.y_axis);
//                },
//                
//                getItem: function(d) {
//                    return d3.select("#viz").selectAll("circle").filter(function(e) {
//                        return d.name == e.name;
//                    });
//                },
//                
//                onMouseover: function(d) {
//                    this.getItem(d)  //selects the current circle the user is hovering over
//                            .attr("r",10) //changes radius to 10
//                            .style("fill", "orange");
//                    var tooltip = d3.select("#tooltip");
//                    tooltip.select("#countryName").text(d.name);
//                    tooltip.select("#countryEOB").text("EOB:  " + d.EOB);
//                    tooltip.select("#countryGDP").text("GDP:  " + d.GDPstring);
//
//                    //style the tooltip to display where the mouse is
//                    tooltip.style("display", "block");
//                    tooltip.style("top", ((d3.event.y) + 10) + "px");	
//                    tooltip.style("left", ((d3.event.x) + 10) + "px");
//                },
//                
//                onMouseout: function(d) {
//                    this.getItem(d)
//                        .attr("r", 5)
//                        .style("fill", "red");
//                    d3.select("#tooltip").style("display", "none");
//                },
//                
//                onClick: function(d) {
//                    d3.select("#infoHeader")
//                                .text(d.name + ' - GDP: ' + d.GDPstring + ' - EOB: ' + d.EOB).style("display", "block");
//                },
//                
//                onRight: function(d) {
//                    d3.event.preventDefault(); //prevents the default context menu from displaying
//                    d3.select("#tooltip").style("display", "none");
//                    Controller.remove(d);
//                }
//            }
        </script>
	</body>
</html>